dig: Domain Information Groper

dig @dnsserver name querytype
querytype A/AAAA/CNAME/PTR/MX/SRV/SIG/HINFO/SOA/ALL/TXT/ANY 默认查询 A 记录

dig @8.8.8.8 www.baidu.com A

-c 可以设置协议类型(class), 包括 IN(默认)、CH 和 HS.
-f dig 支持从一个文件里读取内容进行批量查询, 文件的内容要求一行为一个查询请求.
$ cat querylist.txt // 文件内容, 共有两个域名需要查询
www.baidu.com
www.sohu.com

$ dig -f querylist.txt -c IN -t A // 设置 -f 参数开始批量查询

-4 和 -6 两个选项, 用于设置仅适用哪一种作为查询包传输协议, 分别对应着 IPv4 和 IPv6.
-t 用来设置查询类型, 默认情况下是 A, 也可以设置 MX 等类型.
-q 其实它本身是一个多余的选项, 但是它在复杂的 dig 命令中又是那么的有用.
	它可以显式设置要查询的域名, 这样可以避免和其他众多的参数、选项相混淆, 提高了命令的可读性.
-x 逆向查询选项. 可以查询 IP 地址到域名的映射关系

dig 还有一批所谓的“查询选项”, 这批选项的使用与否, 会影响到 dig 的查询方式或输出的结果信息, 
因此对于这批选项, dig 要求显式的在其前面统一的加上一个“+”(加号), 这样 dig 识别起来会更方便, 同时命令的可读性也会更强.
dig 总共有 42 个查询选项, 涉及到 DNS 信息的方方面面.

DNS 查询过程中的交互是采用 UDP 的. 如果希望采用 TCP 方式:
dig +tcp www.baidu.com

dig +domain=baidu.com image

dig 非常著名的一个查询选项就是 +trace, dig 会从根域查询一直跟踪直到查询到最终结果, 并将整个过程信息输出出来.
dig +trace baidu.com

+nocmd, 可以节省输出 dig 版本信息.
+short, 仅会输出最精简的 CNAME 信息和 A 记录, 其他都不会输出.
+nocomment, 可以节省输出 dig 的详情注释信息.
+nostat, 最后的统计信息不会输出.
+noquestion, +noanwser, 

dig www.facebook.com @8.8.8.8 +short
37.61.54.158
在 wiki 词条域名服务器缓存污染中可以发现 37.61.54.158 在虚假 ip 地址中, 说明此 dns 已遭污染.
http://zh.wikipedia.org/zh-cn/%E5%9F%9F%E5%90%8D%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%93%E5%AD%98%E6%B1%A1%E6%9F%93#cite_note-3

dig www.facebook.com @208.67.222.222 -p 443 +short
31.13.79.49
31.13.79.49 为 facebook 的正确地址. google 的 dns 服务不支持特殊端口查询, 但 opendns 支持, 其 ip 为 208.67.222.222, 208.67.222.220, 支持的特殊端口为 443, 5353.

DNS 服务器分为：主服务器、备份服务器和缓存服务器。在主备服务器之间同步数据库, 需要使用“DNS域传送”。
域传送是指备份服务器从主服务器拷贝数据, 并用得到的数据更新自身数据库. 若 DNS 服务器配置不当, 可能导致匿名用户获取某个域的所有记录.
造成整个网络的拓扑结构泄露给潜在的攻击者, 包括一些安全性较低的内部主机, 如测试服务器. 凭借这份网络蓝图, 攻击者可以节省很少的扫描时间.
大的互联网厂商通常将内部网络与外部互联网隔离开, 一个重要的手段是使用 Private DNS. 如果内部 DNS 泄露, 将造成极大的安全风险. 风险控制不当甚至造成整个内部网络沦陷.

域维护是指通过 DNS 协议来在主域名服务器和从域名服务器之间维护同一个 zone 文件.
DNS 中有两种域维护手段, 一种是全量传输 AXFR(full zone transfer), 另一种是增量传输 IXFR(incremental zone transfer).

将查询类型设定为 axfr, 就能得到域传送数据, 用来测试 DNS 域传送泄露
dig axfr @dns.nwpu.edu.cn nwpu.edu.cn
dig ns szgwbn.net
dig axfr @ns2.szgwbn.net szgwbn.net
dig axfr @211.162.78.1 szgwbn.net

GOOGLE:
8.8.8.8
8.8.4.4

baidu(notcp):
180.76.76.76
http://dudns.baidu.com

ali(notcp):
223.5.5.5
223.6.6.6
http://www.alidns.com

CNNIC:
210.2.1.1
210.2.2.2
1.2.4.8

114:
114.114.114.114
114.114.115.115

OPENDNS:
208.67.222.222
208.67.220.220

Apple TV:
180.153.225.136 上海电信
115.29.189.118 杭州电信
203.195.182.150 广东电信
118.244.224.124 北方联通

Norton DNS:
198.153.192.1
198.153.194.1

ClearCloud:
74.118.212.1
74.118.212.2

电信
101.226.4.6
218.30.118.6

联通
123.125.81.6
140.207.198.6

移动
101.226.4.6
218.30.118.6

铁通
101.226.4.6
218.30.118.6

GFW 污染(2015 已不再固定, 且对 tcp 方式进行干扰):
4.36.66.178
8.7.198.45
23.89.5.60
37.61.54.158
46.82.174.68
49.2.123.56
54.76.135.1
59.24.3.173
64.33.88.161
64.33.99.47
64.66.163.251
65.104.202.252
65.160.219.113
66.45.252.237
72.14.205.99
72.14.205.104
77.4.7.92
78.16.49.15
93.46.8.89
118.5.49.6
128.121.126.139
159.106.121.75
169.132.13.103
188.5.4.96
189.163.17.5
192.67.198.6
197.4.4.12
202.106.1.2
202.181.7.85
203.98.7.65
203.161.230.171
207.12.88.98
208.56.31.43
209.36.73.33
209.145.54.50
209.220.30.174
211.94.66.147
213.169.251.35
216.221.188.182
216.234.179.13
243.185.187.39
249.129.46.48
253.157.14.165
